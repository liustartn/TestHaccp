<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="haccp.ico">
  <title>HACCP</title>

  <!-- 全站樣式 -->
  <link rel="stylesheet" href="index_style.css">
  <link rel="stylesheet" href="最新消息跑馬燈.css">
  <link rel="stylesheet" href="幻燈片_style.css">

  <!-- 全頁淡入 & Loading -->
  <style>
    body {
      opacity: 0;
      transition: opacity .8s ease;
    }

    body.show {
      opacity: 1;
    }

    /* Loading 動畫 */
    #loading-screen {
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, .9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      z-index: 9999;
    }

    .spinner {
      width: 35px;
      height: 35px;
      border: 4px solid #ccc;
      border-top-color: #2b6777;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>

  <!-- Loading 畫面 -->
  <div id="loading-screen">
    <div class="spinner"></div>
  </div>

  <!-- header -->
  <div id="header-container"></div>

  <!-- 最新消息跑馬燈 -->
  <div id="最新消息跑馬燈區"></div>

  <!-- 幻燈片 -->
  <div id="slideshow-container"></div>

  <!-- 書寫範例教學（不載內容，可保留） -->
  <div id="書寫範例教學-container"></div>

  <!-- 主要連結 -->
  <section class="link-cards">

    <div class="menu-wrap">
      <button class="menu-btn" id="govToggle">相關網站</button>

      <div class="menu-popover" id="govMenu">
        <a class="menu-item" href="https://www.fda.gov.tw/TC/index.aspx" target="_blank">
          <div class="item-title">衛生福利部食品藥物管理署</div>
          <div class="item-sub">https://www.fda.gov.tw/TC/index.aspx</div>
        </a>

        <a class="menu-item" href="https://foodedu.fda.gov.tw/tblu/main/ap/index.jsp" target="_blank">
          <div class="item-title">食品衛生安全課程資訊管理系統</div>
          <div class="item-sub">https://foodedu.fda.gov.tw/tblu/main/ap/index.jsp</div>
        </a>

        <a class="menu-item" href="https://www.cas.org.tw/" target="_blank">
          <div class="item-title">台灣優良農產品發展協會</div>
          <div class="item-sub">https://www.cas.org.tw/</div>
        </a>

        <a class="menu-item" href="https://www.moa.gov.tw/" target="_blank">
          <div class="item-title">行政院農業部</div>
          <div class="item-sub">https://www.moa.gov.tw/</div>
        </a>

      
      </div>
    </div>

    <a class="card" href="https://docs.google.com/forms/d/e/1FAIpQLSdqkEUZeXdLS93NGsO_EeJAccC1SkvjrUIKkrJ7LYG94bG0WA/viewform?pli=1" target="_blank">
      <img class="card-icon"
        src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5b/Google_Forms_2020_Logo.svg/330px-Google_Forms_2020_Logo.svg.png">
      <div>
        <h3 class="card-title">114年度食品安全管制系統訓練班(60A及60B)*報名表</h3>
        <div class="card-url">https://docs.google.com/forms/d/e/1FAIpQLSdqkEUZeXdLS93NGsO_EeJAccC1SkvjrUIKkrJ7LYG94bG0WA/viewform?pli=1</div>
      </div>
    </a>

    <a class="card" href="https://docs.google.com/forms/d/e/1FAIpQLSfaLwVxreosJ62xDCCAWRCFpsuaxmJO0PK4MLewo3cs6AvOUQ/viewform" target="_blank">
      <img class="card-icon"
        src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5b/Google_Forms_2020_Logo.svg/330px-Google_Forms_2020_Logo.svg.png">
      <div>
        <h3 class="card-title">114年度食品安全管制系統訓練班(60A及60B)-屏科大</h3>
        <div class="card-url">https://docs.google.com/forms/d/e/1FAIpQLSfaLwVxreosJ62xDCCAWRCFpsuaxmJO0PK4MLewo3cs6AvOUQ/viewform</div>
      </div>
    </a>

  </section>

  <div id="xiang_footer-container"></div>


  <!-- ************ 模組化 JS 區 ************ -->
  <script>
    /* -------- 模組 1：載入外部 HTML ---------- */
    async function includeHTML(id, url) {
      try {
        const res = await fetch(url);
        const html = await res.text();
        document.getElementById(id).innerHTML = html;
      } catch (e) {
        console.error(`載入 ${url} 失敗：`, e);
      }
    }

    /* -------- 模組 2：地政專區下拉 ---------- */
    function setupGovMenu() {
      const btn = document.getElementById("govToggle");
      const menu = document.getElementById("govMenu");
      if (!btn || !menu) return;

      btn.onclick = (e) => {
        const open = menu.style.display === "block";
        menu.style.display = open ? "none" : "block";
        e.stopPropagation();
      };

      document.addEventListener("click", (e) => {
        if (!menu.contains(e.target) && e.target !== btn)
          menu.style.display = "none";
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") menu.style.display = "none";
      });
    }

    /* -------- 模組 3：幻燈片初始化 ---------- */
    function setupSlideshow() {
      const slides = document.querySelectorAll(".slide");
      const dots = document.querySelectorAll(".dot");
      const prev = document.querySelector(".prev");
      const next = document.querySelector(".next");
      const slider = document.getElementById("slider");

      if (!slides.length) return; // 沒有載入成功就直接跳過

      let index = 0;
      let timer;

      function show() {
        slides.forEach(s => s.style.display = "none");
        dots.forEach(d => d.classList.remove("active"));

        if (index >= slides.length) index = 0;
        if (index < 0) index = slides.length - 1;

        slides[index].style.display = "block";
        if (dots[index]) dots[index].classList.add("active");
      }

      function start() {
        stop();
        timer = setInterval(() => {
          index++;
          show();
        }, 5000);
      }

      function stop() {
        if (timer) clearInterval(timer);
      }

      prev && prev.addEventListener("click", () => { index--; show(); start(); });
      next && next.addEventListener("click", () => { index++; show(); start(); });
      dots.forEach((dot, i) => {
        dot.addEventListener("click", () => { index = i; show(); start(); });
      });

      if (slider) {
        slider.addEventListener("mouseenter", stop);
        slider.addEventListener("mouseleave", start);
      }

      show();
      start();
    }

    /* -------- ⭐ 模組 4：header 字體大小切換 ---------- */
    function setupFontSizeSwitcher() {
      const KEY = "siteFontSize";
      const html = document.documentElement;

      function apply(size) {
        html.classList.remove("fs-sm", "fs-md", "fs-lg");
        html.classList.add("fs-" + size);
        localStorage.setItem(KEY, size);
        syncActive();
      }

      function syncActive() {
        const switcher = document.getElementById("fontSwitch");
        if (!switcher) return;
        const current = localStorage.getItem(KEY) || "md";
        switcher.querySelectorAll("button").forEach(b => {
          b.classList.toggle("active", b.dataset.size === current);
        });
      }

      // 事件委派：點 header 裡的 大/中/小 按鈕
      document.addEventListener("click", (e) => {
        const btn = e.target.closest("#fontSwitch button[data-size]");
        if (!btn) return;
        apply(btn.dataset.size);
      });

      // 初始化：套用上次選擇的字級
      apply(localStorage.getItem(KEY) || "md");
      // header 已經載入好了，再同步一次 active 樣式
      syncActive();
    }

    /* -------- 模組 5：全頁 Loading ---------- */
    function hideLoading() {
      const l = document.getElementById("loading-screen");
      if (l) l.style.display = "none";
      document.body.classList.add("show");
    }

    /* -------- 模組 6：初始化 ---------- */
    async function init() {
      await Promise.all([
        includeHTML("header-container", "header.html"),
        includeHTML("最新消息跑馬燈區", "最新消息跑馬燈.html"),
        includeHTML("slideshow-container", "幻燈片和右方文字區塊.html"),
        includeHTML("xiang_footer-container", "xiang_footer.html")
      ]);

      setupGovMenu();
      setupSlideshow();
      setupFontSizeSwitcher();  // ⭐ 把字級切換功能接回來
      hideLoading();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>

</body>

</html>
